services:
  # Main application
  php:
    build: .
    container_name: php
    volumes:
      - ./app:/var/www/html
    labels:
      - "traefik.enable=false" # Backend container, no direct access
    networks:
      - app-network

  # Database
  mariadb:
    image: mariadb:latest
    container_name: mariadb
    environment:
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_DATABASE: my_database
      MYSQL_USER: my_user
      MYSQL_PASSWORD: my_password
    volumes:
      - mariadb_data:/var/lib/mysql
    networks:
      - app-network

  # Web server
  nginx:
    image: nginx:latest
    container_name: nginx
    ports:
      - "80:80"
    volumes:
      - ./app:/var/www/html
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - php
      - mariadb
    networks:
      - app-network

  # Static files
  # nginx:
  #   image: nginx:alpine
  #   volumes:
  #     - ./app:/var/www/html
  #     - ./nginx-static.conf:/etc/nginx/conf.d/default.conf
  #   labels:
  #     - "traefik.enable=true"
  #     - "traefik.http.routers.static.rule=Host(`project.localhost`) && PathPrefix(`/wp-content/uploads/`, `/assets/`, `/static/`)"
  #     - "traefik.http.services.static.loadbalancer.server.port=80"
  #   networks:
  #     - app-network

  # Traefik: alternative to nginx
  # traefik:
  #   image: traefik:latest
  #   container_name: traefik
  #   ports:
  #     - "80:80"
  #     - "443:443"
  #     - "8081:8080" # Dashboard
  #   volumes:
  #     - /var/run/docker.sock:/var/run/docker.sock
  #     - ./traefik/traefik.yml:/etc/traefik/traefik.yml
  #     - ./traefik/config:/etc/traefik/config
  #     - ./traefik/certificates:/etc/traefik/certificates
  #   networks:
  #     - app-network

  # Database management
  # phpmyadmin:
  #   image: phpmyadmin/phpmyadmin
  #   container_name: phpmyadmin
  #   environment:
  #     PMA_HOST: mariadb
  #     MYSQL_ROOT_PASSWORD: root_password
  #   ports:
  #     - "8080:80"
  #   depends_on:
  #     - mariadb
  #   networks:
  #     - app-network


  # Database management. Alternative to phpmyadmin
  adminer:
    image: adminer
    container_name: adminer
    ports:
      - "8082:8080"
    networks:
      - app-network

  # Email server
  # mailhog:
  #   image: mailhog/mailhog:latest
  #   container_name: mailhog
  #   ports:
  #     - "1025:1025"
  #     - "8025:8025"
  #   networks:
  #     - app-network

  # Composer
  # composer:
  #   image: composer:latest
  #   container_name: composer
  #   volumes:
  #     - ./app:/var/www/html
  #   working_dir: /var/www/html
  #   networks:
  #     - app-network

  # For caching and as a message broker
  # redis:
  #   image: redis:alpine
  #   container_name: redis
  #   ports:
  #     - "6379:6379"
  #   volumes:
  #     - redis_data:/data
  #   networks:
  #     - app-network

  # For frontend build processes (for Vue/React)
  node:
    image: node:alpine
    container_name: node
    volumes:
      - ./app:/var/www/html
    working_dir: /var/www/html
    networks:
      - app-network
  # For advanced search and analytics capabilities
  # elasticsearch:
  #   image: elasticsearch:7.17.0
  #   container_name: elasticsearch
  #   environment:
  #     - discovery.type=single-node
  #     - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
  #   ports:
  #     - "9200:9200"
  #   volumes:
  #     - elasticsearch_data:/usr/share/elasticsearch/data
  #   networks:
  #     - app-network

  # Alternative caching solution
  # memcached:
  #   image: memcached:alpine
  #   container_name: memcached
  #   ports:
  #     - "11211:11211"
  #   networks:
  #     - app-network
  # S3-compatible object storage
  # minio:
  #   image: minio/minio
  #   container_name: minio
  #   ports:
  #     - "9000:9000"
  #     - "9001:9001"
  #   environment:
  #     - MINIO_ROOT_USER=minio
  #     - MINIO_ROOT_PASSWORD=minio123
  #   volumes:
  #     - minio_data:/data
  #   command: server /data --console-address ":9001"
  #   networks:
  #     - app-network

volumes:
  mariadb_data:
    # redis_data:
    # elasticsearch_data:
    # minio_data:


networks:
  app-network:
    driver: bridge
